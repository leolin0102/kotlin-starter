
## 开发环境准备

Kotlin为我们提供了语言级别的全栈开发方案，本章我们来一步一步的setup，编译器环境，IDEA，Android Studio，并分实现web端，android，jvm和native端的‘hello kotlin’程序。

### 变异环境

Kotlin支持REPL，交互式运行环境，安装Kotlin SDK后就可以启动命令行窗口，输入kotlinc-jvm，就可以启动。

#### 手动安装

我们可以从github上下载最新版本的Kotlin的独立运行版本。最新的版本可以从下面的链接中下载。

https://github.com/JetBrains/kotlin/releases/tag/v1.1.3-2

下载 kotlin-compiler-1.1.3-2.zip 后，解压缩后，可以通过设置系统path路径到bin目录，这样我们就可以在我们的代码目录下运行编译命令来编译我们的代码，或者输入 kotlinc-jvm启动REPL模式.

注意：启动REPL环境前确保我们安装了最新版本的虚拟机，虽然Kotlin可以运行在1.6 java环境下，但是REPL模式，要求本地安装最新版本的java虚拟机。

leo$ kotlinc-jvm

Welcome to Kotlin version 1.1.3-2 (JRE 1.8.0_131-b11)

Type :help for help, :quit for quit

&gt;&gt;&gt; 

#### SDKMAN! 安装

在UNIX based系统中，例如 OS X， Linux， Cygwin，FreeBSD下，使用SDKMAN!会很方便。首先如果我们还没有安装SDKMAN!，可以在命令行窗口下使用下面的命令来安装SDKMAN!

$ curl -s https://get.sdkman.io | bash

然后，重新打开一个命令行窗口，输入下面的命令，我们就可以完成安装了。

$ sdk install kotlin

#### HomeBrew 安装

如果我们的开发机器是MAC电脑，运行OS X，我们可以通过HomeBrew安装。

$ brew update
$ brew install kotlin

#### MacPorts

Mac下我们也可以使用下面的命令安装：

$ sudo port install kotlin

### 编写我们第一个Kotlin应用 （出发）

1. 首先我们可以用任何文本编辑器来创建源代码文件hello.kt。

<pre><code>
fun main(args: Array&lt;String&gt;) {
    println("Hello, Kotlin!")
}
</code></pre>

2. 使用 Kotlin 编译器编译

$ kotlinc hello.kt -include-runtime -d hello.jar

-d 选项制定输出的编译后的文件的名字，我们不仅可以指定输出jar包，也可以指定目录输出class文件。-include-runtime 选项指定输出的jar包可以独立运行且包含运行时的所有资源，包括Kotlin运行时库。

3. 运行我们第一个应用

$ java -jar hello.jar 
Hello, Kotlin!

我们的第一个 Kotlin 程序就完成了。

### 运行REPL

REPL的编程体验，使得我们可以通过不断的是错，调整，然后验证的方式来逼近我们的目标。我第一次接触REPL环境实际上是LISP和Python，开始的时候，我仅仅把它们当作一个游戏过程，或者是简单逻辑的测试。但是，慢慢的，我发现，一旦开始了，就无法停下，很多程序我从前都会封装成命令行应用或者守护进程模式运行，现在，我的很多程序或者脚本都没有main函数。同时当你慢慢的习惯编写函数式的代码，慢慢的你会发现，你的代码已经形成了一套自己的函数库，可以让你像写文章一样的写出一行功能强大的语句来完成你的工作。

$ kotlinc-jvm
Welcome to Kotlin version 1.1.3-2 (JRE 1.8.0_131-b11)

Type :help for help, :quit for quit

&gt;&gt;&gt; 2+2

&gt;&gt;&gt; 4

&gt;&gt;&gt; println("Hello Kotlin")

Hello Kotlin

&gt;&gt;&gt;

&gt;&gt;&gt; println("Hello Kotlin")

Hello Kotlin

&gt;&gt;&gt;

&gt;&gt;&gt; fun sayHello(str: String) {

...     println(str)

... }

&gt;&gt;&gt; 

&gt;&gt;&gt; sayHello("Hello Kotlin")

Hello Kotlin

在REPL环境下，我们可以直接输入表达式回车来执行，也可以定义我们的函数和类。也同样可以导入我们已经写好的其他的资源。

### 命令行运行Kotlin脚本

和Groovy语言一样，Kotlin也可以支持脚本模式，我们可以编写Kotlin脚本，Kotlin的脚本扩展名为.kts。 

<pre><code>
import java.io.File

val folders = File(args[0]).listFiles { file -> file.isDirectory() }
folders?.forEach { folder -> println(folder) }
</code></pre>

我们需要使用-script选项，编译器就会执行我们的脚本。

$ kotlinc -script list_folders.kts &lt;path_to_folder_to_inspect&gt;

### 在线环境

Kotlin官方提供在线的运行环境Kotlin Koans online，Koans不仅仅是一个在线的Kotlin运行时环境，同时也是个很好的教学课件，我们可以通过这个在线环境逐步熟悉和掌握Kotlin这个语言。https://try.kotlinlang.org

<img src="./images/try-kotlin.png"/>

我们上半部分介绍的内容，推荐大家在REPL，在线环境或者自己编写脚本来验证，这样我们能第一时间看到介绍的东西活生生的样子。其实我们生活中有太多的东西都可以用程序来实现，例如，有一个数据，你从前用纸笔记录和计算得出的，ok，当你再有同样的需求的时候，请你尝试用kotlin实现一个工具来做这样的事情，记住，工程师永远都不该像计算机那样做重复的工作，该由计算机做的事情，就让它们做。

### IDEA

IDEA是非常出色的开发环境，我们可以使用IDEA来开发服务器端程序，IDEA分为社区版本和收费版本，如果仅仅做后台开发，使用社区版本已经足够。但是如果我们希望开发前端代码，最好使用收费的版本，会增加代码重复检测，版本控制（Perforce, ClearCase, TFS）, JavaScript，TypeScript。

IDEA的下载地址是http://www.jetbrains.com/idea/download

1. 下载最新版本的IDEA并安装，从IDEA version 15 后，Kotlin开发环境被默认绑定到IDEA中，因此，下载后，我们就可以直接开始我们的工作了。
2. 新建一个project，我们可以选择java Module，并添加Kotlin（Java）然后点击下一步。

<img src="./images/new_project_step1.png"/>

3. 给项目命名

<img src="./images/project_name.png"/>

4. 点击Finish完成项目创建。

<img src="./images/folders.png"/>

5. 在src文件夹下右键打开菜单，New &gt; Kotlin File/Class 创建app.kt文件。

<img src="./images/new_file.png"/>

6. 为新创建的Kotlin class 增加main方法和实现。

<img src="./images/main.png"/>
<img src="./images/hello_world.png"/>

7. 可以通过在代码编辑窗口内右键，选择运行来直接运行

<img src="./images/run_window.png"/>

### Android Studio

目前，绑定Kotlin插件的Android Studio版本是 version 3.0 (https://developer.android.com/studio/preview/index.html), 如果我们想在更早的Android Studio进行开发，我们需要手动安装插件。选择菜单 File | Settings | Plugins | Install JetBrains plugin，搜索Kotlin，我们可以跟随引导进行plugin 的安装。

我们可以从android开发者网站下载支持kotlin开发的Android Studio 3版本，目前还是预览版本，但是已经很稳定了。遗憾的是在中国，android开发网站被屏蔽需要我们vpn翻墙才可以，但是，国内也有很多中文镜像网站，可以供我们下载。

1. 启动Android Studio后，同样会看到欢迎页面，我们选择创建项目。

<img src="./images/android-welcome.png"/>

2. 之后，会进入到新建项目的引导流程的第一页，这里我们要勾选Kotlin支持。

<img src="./images/android-new-app.png"

3. 点击Next 进入项目配置页面,我们在这里设置app支持的SDK的版本和应用程序的类型，我们选择的SDK版本越低，可以是配的设备就越多，相反，版本过高，我们能运用到的特性就越好。SDK的选择需要看具体应用的定位和需要依赖的系统特性来定。

<img src="./images/android-select-sdk.png"/>

4. 点击Next后，会进入Activity 设置页面，Android中Activity的作用是控制每个独立页面的生命周期，控件事件的处理的，因此，一个android app需要有一个主Activity类。这里我们可以制定主Activity的类名，页面标题，和页面布局文件的名称。

<img src="./images/android-first-activity.png"/>

5. 点击Next后，我们最终会进入到引导流程的最后一步，就是指定我们应用程序的导航模式。可以选择的选项由，单页面应用(Basic Activity)，底部页签导航模式(Bottom Navigation Activity),空白Activity(空白Activity与Basic Activity的区别在于，后者顶部导航栏有menu菜单),全屏模式（游戏开发）

<img src="./images/android-select-app-type.png"

6. 完成后，我们就可以开始开发Android App了。

<img src="./images/android-project.png"/>

本书会带着大家逐步实现一个实现番茄工作法的应用来让大家掌握如何运用Kotlin的特性来优化我们的设计，让我们的产品具备扩展性，可维护行和优雅。因为Kotlin可以运行在JVM，Javascript（web），android， 甚至是IOS上，因此我们会在本书，尝试使用kotlin 这一种语言给出这个应用的全部解决方案。包括云端可以保存纷享用户的时间管理数据，客户端可以帮助用户引导用户使用番茄工作法来优化日常的工作，并将数据上传到云端，由云端给出用户的统计数据，和一些建议。并将Koglin的数据持久和通信部分输出成Native库，共享给IOS客户端也Web前端。在这这本书的时候，我也不确定我们是否可以做到这一点，But, I'm willing to try and find pleasure from it.

